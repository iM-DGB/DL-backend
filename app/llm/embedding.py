from langchain_upstage import UpstageEmbeddings
import numpy as np
import os
from dotenv import load_dotenv

# ðŸ” í™˜ê²½ë³€ìˆ˜ ë¡œë”©
load_dotenv()
api_key = os.getenv("SOLAR_API_KEY")

# ðŸ”¹ ëª¨ë¸ ë¡œë”© (ìµœì´ˆ 1íšŒ)
solar_model = UpstageEmbeddings(
    model="solar-embedding-1-large",
    api_key=api_key
)

# ðŸ” í‚¤ì›Œë“œ ê¸°ë°˜ íƒœê·¸ ì‚¬ì „
SEARCH_HINTS = {
    # ðŸ”¹ ê³µí†µ ì•½ê´€ í‚¤ì›Œë“œ
    "ë¶€ì¹™": "[ë¶€ì¹™ ê´€ë ¨ ë‚´ìš©]",
    "ì²­ì•½ì² íšŒ": "[ì²­ì•½ ì² íšŒ ì•ˆë‚´]",
    "ê³„ì•½í•´ì§€": "[ê³„ì•½ í•´ì§€ ê·œì •]",
    "ë©´ì±…": "[ë³´ìž¥ ì œì™¸ ì‚¬í•­]",
    "ì˜ˆì™¸": "[ë³´ìž¥ ì œì™¸ ì‚¬í•­]",
    "ë³´ìž¥": "[ë³´ìž¥ í•­ëª©]",
    "ê°€ìž…ì¡°ê±´": "[ê°€ìž… ì¡°ê±´]",
    "ê°€ìž…ë‚˜ì´": "[ê°€ìž… ê°€ëŠ¥ ì—°ë ¹]",
    "ë‚©ìž…": "[ë‚©ìž… ì¡°ê±´]",
    "ê¸ˆë¦¬": "[ê¸ˆë¦¬ ì¡°ê±´]",
    "ì´ìœ¨": "[ê¸ˆë¦¬ ì¡°ê±´]",
    
    # ðŸ”¹ ì˜ˆê¸ˆ
    "ì •ê¸°ì˜ˆê¸ˆ": "[ì˜ˆê¸ˆ ìƒí’ˆ]",
    "ì˜ˆì¹˜ê¸ˆ": "[ì˜ˆê¸ˆ ìƒí’ˆ]",
    "ì´ìžì§€ê¸‰": "[ì˜ˆê¸ˆ ìƒí’ˆ ì´ìž ì§€ê¸‰ ë°©ì‹]",
    
    # ðŸ”¹ ì ê¸ˆ
    "ì •ê¸°ì ê¸ˆ": "[ì ê¸ˆ ìƒí’ˆ]",
    "ìžë™ì´ì²´": "[ì ê¸ˆ ìžë™ì´ì²´]",
    "ë§Œê¸°": "[ë§Œê¸° ì¡°ê±´]",
    
    # ðŸ”¹ í†µìž¥
    "ìž…ì¶œê¸ˆ": "[ìž…ì¶œê¸ˆ í†µìž¥]",
    "ìžìœ ìž…ì¶œê¸ˆ": "[ìž…ì¶œê¸ˆ í†µìž¥]",
    "ìˆ˜ìˆ˜ë£Œ": "[í†µìž¥ ìˆ˜ìˆ˜ë£Œ í˜œíƒ]",
    "ë¹„ëŒ€ë©´ê°œì„¤": "[í†µìž¥ ê°œì„¤ ë°©ì‹]",
    
    # ðŸ”¹ ëŒ€ì¶œ
    "ì‹ ìš©ëŒ€ì¶œ": "[ì‹ ìš©ëŒ€ì¶œ ìƒí’ˆ]",
    "ë‹´ë³´ëŒ€ì¶œ": "[ë‹´ë³´ëŒ€ì¶œ ìƒí’ˆ]",
    "ê¸ˆë¦¬": "[ëŒ€ì¶œ ê¸ˆë¦¬]",
    "ìƒí™˜": "[ëŒ€ì¶œ ìƒí™˜ ë°©ì‹]",
    "í•œë„": "[ëŒ€ì¶œ í•œë„]",
    "ëŒ€ì¶œì¡°ê±´": "[ëŒ€ì¶œ ì¡°ê±´]",
}

def embed_query_locally(text: str) -> np.ndarray:
    # ðŸ”Ž ì‚¬ì „ íƒœê·¸ ì‚½ìž…
    for keyword, tag in SEARCH_HINTS.items():
        if keyword in text:
            text = f"{tag} {text}"
            break

    # ðŸ”„ ìž„ë² ë”© ìˆ˜í–‰
    vector = solar_model.embed_query(text)
    return np.array(vector)
